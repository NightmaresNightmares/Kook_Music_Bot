

# 🎵 Kook音乐机器人

一个功能完整的Kook音乐机器人，支持语音频道点歌、网页控制、定时任务等多种功能。

## ✨ 功能特性

### 🎵 音乐功能
- **搜索歌曲**: 支持通过歌曲名或歌手名搜索
- **网易云每日推荐**: 获取每日推荐歌单
- **音频播放**: 使用推流技术在语音频道播放音乐
- **播放控制**: 支持跳过、停止、跳转等操作
- **播放列表**: 查看当前播放队列

### 🌐 Web控制面板
- **搜索歌曲**: 网页端搜索并试听歌曲
- **机器人控制**: 发送指令和文本消息
- **定时任务**: 设置定时发送消息
- **系统监控**: 查看日志和系统状态
- **设置管理**: 配置欢迎语句等

### 🤖 机器人命令
- `/点歌 歌曲名` - 搜索并播放歌曲
- `/跳过` - 跳过当前歌曲
- `/停止` - 停止播放
- `/列表` - 查看播放列表
- `/跳转 秒数` - 跳转到指定时间
- `/推荐` - 获取每日推荐
- `/说话 文本` - 让机器人发送文本
- `/帮助` - 显示帮助信息

### 📊 日志系统
- **系统日志**: 记录机器人运行状态
- **操作日志**: 记录每一步操作（中文输出）
- **错误日志**: 记录错误信息便于排查

### ⏰ 定时任务
- **定时消息**: 支持每日定时和间隔定时
- **任务管理**: 添加、删除、查看定时任务

### 👋 欢迎功能
- **新用户欢迎**: 用户加入语音频道时自动发送欢迎消息
- **自定义欢迎语**: 支持自定义欢迎消息内容

## 🚀 快速开始

### 1. 环境要求
- Python 3.8+
- FFmpeg（用于音频处理）
- Kook机器人Token

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 配置环境
```bash
# 复制配置文件
cp .env.example .env

# 编辑配置文件，填入你的机器人信息
nano .env
```

### 4. 配置说明
在`.env`文件中配置以下参数：
```env
BOT_TOKEN=your_bot_token_here          # 机器人Token
GUILD_ID=your_guild_id_here            # 服务器ID
VOICE_CHANNEL_ID=your_voice_channel_id # 语音频道ID（可选）
TEXT_CHANNEL_ID=your_text_channel_id   # 文字频道ID（可选）
ADMIN_ID=your_admin_user_id_here       # 管理员用户ID（可选）
```

### 5. 启动机器人
```bash
# 使用启动脚本（推荐）
python start.py

# 或直接启动
python bot.py
```

### 6. 访问Web控制面板
启动后访问: `http://localhost:12000`

## 📁 项目结构

```
Kook_Music_Bot/
├── bot.py                 # 主机器人文件
├── config.py             # 配置管理
├── logger_manager.py     # 日志管理
├── music_service.py      # 音乐服务
├── scheduler_manager.py  # 定时任务管理
├── web_interface.py      # Web界面
├── start.py             # 启动脚本
├── requirements.txt     # 依赖包
├── .env.example        # 配置文件示例
├── README.md           # 说明文档
└── logs/               # 日志目录
    ├── bot.log         # 系统日志
    └── bot_operations.log # 操作日志
```

## 🔧 技术栈

- **机器人框架**: khl.py
- **推流模块**: simple-kook-voice
- **Web框架**: Flask
- **定时任务**: schedule
- **音频处理**: FFmpeg
- **API服务**: 网易云音乐API

## 📝 使用说明

### Kook频道使用
1. 邀请机器人到你的服务器
2. 给机器人分配必要权限（连接语音频道、发送消息等）
3. 在文字频道使用命令，如：`/点歌 夜曲`

### 网页控制使用
1. 访问Web控制面板
2. 在搜索页面搜索歌曲并试听
3. 点击"在Kook中播放"将歌曲添加到机器人播放列表
4. 使用控制面板管理机器人和定时任务

## 🚨 故障排除

### 常见问题

**机器人无法加入语音频道**
- 检查机器人权限，确保有"连接语音频道"权限
- 确认语音频道ID配置正确

**音乐播放失败**
- 检查FFmpeg是否正确安装
- 检查网络连接和音频链接有效性
- 查看日志文件获取详细错误信息

**搜索功能异常**
- 可能是API服务暂时不可用，请稍后重试
- 检查网络连接

**定时任务不执行**
- 检查系统时间设置
- 确认任务配置正确
- 查看操作日志

**日志记录异常**
- 检查磁盘空间
- 检查文件权限
- 确认logs目录存在

### 日志查看
- 系统日志: `logs/bot.log`
- 操作日志: `logs/bot_operations.log`
- Web控制面板也可以查看实时日志

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📄 许可证

MIT License

## 🙏 致谢

- [simple-kook-voice](https://github.com/Edint386/simple-kook-voice) - 提供推流功能
- [khl.py](https://github.com/TWT233/khl.py) - Kook机器人框架
- 网易云音乐API - 提供音乐搜索服务

## 📞 联系方式

如遇到问题或需要帮助，请：
1. 查看日志文件排查问题
2. 提交Issue描述问题
3. 联系项目维护者

---

**注意**: 请确保遵守相关平台的使用条款和版权法律法规。
